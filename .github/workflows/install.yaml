name: project0
# either manually started, or on a schedule
on:
  workflow_dispatch:
  schedule:
    - cron: '0 4 * * *' # At 4:00 UTC everyday
jobs:

  install:
#    env:
#        MAGIC_VERSION:          8.3.209

    # ubuntu
    runs-on: ubuntu-latest
    steps:

    # checkout the repo to get the scripts
    - uses: actions/checkout@v2

    # dependencies we can install from package manager
#    - name: install deps
#      run: sudo apt-get install -y tcsh csh tcl-dev tk-dev libcairo2-dev

    # magic dependency
#    - name: install magic
#      run: bash ${GITHUB_WORKSPACE}/.github/scripts/install_magic.sh

    # test
#    - name: test magic
#      run: magic --version

    # build the user project and wrapper
    - name: pdk & openlane
      run: |
        cd $HOME
        git clone -b mpw-5c https://github.com/efabless/caravel_user_project.git
        cd caravel_user_project/
        export OPENLANE_ROOT=$HOME/openlane
        export PDK_ROOT=$HOME/pdk
        make setup

    - name: user project wrapper GDS
      run: |
        cd $HOME/caravel_user_project
        make user_project_wrapper

    - name: simulation
      run: |
        cd $HOME/caravel_user_project
        make verify-io_ports-rtl

    - name: precheck
      run: |
        cd $HOME/caravel_user_project
        echo 'not default' >> README.md
        make precheck
        make run-precheck

